{"helptext": ["on 0.3                          \\", "              -regress_reml_exec -regress_3dD_stop                \\", "              -regress_stim_times                                 \\", "                  $stim_dir/houses.txt                            \\", "                  $stim_dir/faces.txt                             \\", "                  $stim_dir/doughnuts.txt                         \\", "                  $stim_dir/pizza.txt                             \\", "              -regress_stim_labels                                \\", "                  house face nuts za                              \\", "              -regress_basis 'BLOCK(2,1)'                         \\", "              -regress_opts_3dD                                   \\", "                  -jobs 4                                         \\", "                  -gltsym 'SYM: house -face' -glt_label 1 H-F     \\", "                  -gltsym 'SYM: nuts -za'    -glt_label 2 N-Z     \\", "              -regress_est_blur_errts                             \\", "              -execute", "", "          EOF", "          # EOF denotes the end of the run.afni_proc command", "", "          # now run the analysis (generate proc and execute)", "          tcsh run.afni_proc", "", "       # end loop over subjects", "       end", "", "       ======================================================================", "", "    --------------------------------------------------", "    QUALITY CONTROL NOTE: ~2~", "", "    Look at the data.", "", "    Nothing replaces a living human performing quality control checks by", "    looking at the data.  And the more a person looks at the data, the better", "    they get at spotting anomalies.", "", "    There are 2 types of QC support generated by afni_proc.py, scripts to help", "    someone review the data, and individual text or image files.", "", "        ----------------------------------------------------------------------", "        scripts (the user can run from the results directory):", "", "           @epi_review.FT               - view original (post-SS) EPI data", "           @ss_review_basic             - show basic QC measures, in text", "           @ss_review_driver            - minimum recommended QC review", "           @ss_review_driver_commands   - same, as pure commands", "", "           Notably, the @ss_review_driver script is recommended as the minimum", "           QC to perform on every subject.", "", "        ----------------------------------------------------------------------", "        other files or datasets:   (* shown or reviewed by @ss_review_driver)", "", "        *  3dDeconvolve.err", "", "              This contains any warnings (or errors) from 3dDeconvolve.  This", "              will be created even if 3dREMLfit is run.", "", "        *  anat_final.$subj", "", "              This AFNI dataset should be registered with the final stats", "              (including final_epi_vr_base) and with any applied template.", "              There is also a version with the skull, anat_w_skull_warped.", "", "        *  blur_est.$subj.1D", "", "              This (text) file has the mixed-model ACF (and possibly the FWHM)", "              parameter estimates of the blur.", "", "           Classes", "", "              If 3dSeg is run for anatomical segmentation, this AFNI dataset", "              contains the results, a set of masks per tissue class.  The", "              white matter mask from this might be used for ANATICOR, for", "              example.", "", "           corr_brain", "", "              This AFNI dataset shows the correlation of every voxel with the", "              global signal (brain average time series).", "", "              One can request other corr_* datasets, based on any tissue or ROI", "              mask.  See -regress_make_corr_vols for details.", "", "        *  dfile_rall.1D (and efile.r??.1D)", "", "              This contains the 6 estimated motion parameters across all runs.", "              These parameters are generally used as regressors of no interest,", "              hopefully per run.  They are also used to generate the enorm time", "              series, which is then used for censoring.", "", "           files_ACF", "", "              This directory contains ACF values at different radii per run.", "              One can plot them using something like:", "", "                set af = files_ACF/out.3dFWHMx.ACF.errts.r01.1D", "                1dplot -one -x $af'[0]' $af'[1,2,3]'", "", "        *  final_epi_vr_base", "", "              This dataset is of the EPI volume registration base (used by", "              3dvolreg), warped to the final space.  It should be in alignment", "              with the anat_final dataset (and the template).", "", "           fitts.$subj", "", "              This dataset contains the model fit to the time series data.", "              One can view these time series together in afni using the", "              Dataset #N plugin.", "", "           full_mask.$subj", "", "              This dataset is a brain mask based on the EPI data, generated", "              by 3dAutomask.  Though the default is to apply it as part of the", "              main regression, it is used for computations like ACF and TSNR.", "", "           ideal_*.1D", "", "              These time series text files are the ideal regressors of", "              interest, if appropriate to calculate.", "", "           mat.basewarp.aff12.1D", "", "              This is used to create the final_epi_vr_base dataset.", "", "              Assuming no non-linear registration (including distortion", "              correction), then this matrix holds the combined affine", "              transformation of the EPI to anat and to standard space,", "              as applied to the volume registration base (it does not contain", "              motion correction transformations).", "", "              Time series registration matrices that include motion correction", "              are in mat.r*.warp.aff12.1D (i.e. one file per run).", "", "              In the case of non-linear registration, there is no single file", "              representing the combined transformation, as it is computed just", "              to apply the transformation by 3dNwarpApply.  This command can be", "              found in the proc script or as the last HISTORY entry seen from", "              the output of \"3dinfo final_epi_vr_base\".", "", "        *  motion_${subj}_enorm.1D", "", "              This time series text file is the L2 (Euclidean) norm of the", "              first (backward) differences of the motion parameters.  The", "              values represent time point to time point estimated motion, and", "              they are used for censoring.  Values are zero at the beginning of", "              each run (motion is not computed across runs).", "", "              A high average of these numbers, particularly after the numbers", "              themselves are censored, is justification for dropping a subject.", "              This average is reported by the @ss_review scripts.", "", "           motion_${subj}_censor.1D", "", "              This is a binary 0/1 time series (matching enorm, say), that", "              distinguishes time points which would be censored (0) from those", "              which would not (1).  It is based on the enorm time series and", "              the -regress_censor_motion limit, with a default to censor in", "              pairs of time points.  There may be a combined censor file, if", "              outlier censoring is done (or if a user censor file is input).", "", "           motion_demean.1D", "", "              This is the same as dfile_rall.1D, the motion parameters as", "              estimated by 3dvolreg, except the the mean per run has been", "              removed.", "", "           motion_deriv.1D", "", "              This contains the first (backward) differences from either", "              motion_demean.1D or dfile_rall.1D.  Values are zero at the start", "              of each run.", "", "           out.allcostX.txt", "", "              This holds anat/EPI registration costs for all cost functions.", "              It might be informational to evaluate alignment across subjects", "              and cost functions.", "", "        *  out.cormat_warn.txt", "", "              This contains warnings about a high correlation between any pair", "              of regressors in the main regression matrix, including baseline", "              terms.", "", "        *  out.gcor.1D", "", "              This contains the global correlation, the average correlation", "              between every pair of voxels in the residual time series dataset.", "              This single value is reported by the @ss_review scripts.", "", "           out.mask_ae_dice.txt", "", "              This contains the Dice coefficient, evaluating the overlap", "              between the anatomical and EPI brain masks.", "", "           out.mask_ae_overlap.txt", "", "              This contains general output from 3dOverlap, for evaluating the", "              overlap between the anatomical and EPI brain masks.", "", "        *  out.pre_ss_warn.txt", "", "              This contains warnings about time point #0 in any run where it", "              might be a pre-steady state time point, based on outliers.", "", "        *  out.ss_review.txt", "", "              This is the text output from @ss_review_basic.  Aside from being", "              shown by the @ss_review scripts, it is useful for being compiled", "              across subjects via gen_ss_review_table.py.", "", "        *  outcount_rall.1D (and outcount.r??.1D)", "", "              This is a time series of the fraction of the brain that is an", "              outlier.  It can be used for censoring.", "", "        *  sum_ideal.1D", "", "              As suggested, this time series is the sum of all non-baseline", "              regressors.  It is generated from X.nocensor.xmat.1D if censoring", "              is done, and from X.xmat.1D otherwise.  This might help one find", "              mistakes in stimulus timing, for example.", "", "        *  TSNR_$subj", "", "              This AFNI dataset contains the voxelwise TSNR after regression.", "              The brainwise average is shown in @ss_review_basic.", "", "          X.xmat.1D", "", "              This is the complete regression matrix, created by 3dDeconvolve.", "              One can view it using 1dplot.  It contains all regressors except", "              for any voxelwise ones (e.g. for ANATICOR).", "", "          X.nocensor.xmat.1D", "", "              This is the same as X.xmat.1D, except the nothing is censored,", "              so all time points are present.", "", "        * X.stim.xmat.1D", "", "              This (text) file has the non-baseline regressors (so presumably", "              of interest), created by 3dDeconvolve.", "", "    --------------------------------------------------", "    RESTING STATE NOTE: ~2~", "", "    Resting state data should be processed with physio recordings (for typical", "    single-echo EPI data).  Without such recordings, bandpassing is currently", "    considered as the default.", "", "    Comment on bandpassing:", "", "        Bandpassing is the norm right now.  However most TRs may be too long", "        for this process to be able to remove the desired components of no", "        interest.  On the flip side, if the TRs are short, the vast majority", "        of the degrees of freedom are sacrificed just to do it.  Perhaps", "        bandpassing will eventually go away, but it is the norm right now.", "", "        Also, there is a danger with bandpassing and censoring in that subjects", "        with a lot of motion may run out of degrees of freedom (for baseline,", "        censoring, bandpassing and removal of other signals of no interest).", "        Many papers have been published where a lot of censoring was done,", "        many regressors of no interest were projected out, and there was a", "        separate bandpass operation.  It is likely that many subjects ended up", "        with negative degrees of freedom, making the resulting signals useless", "        (or worse, misleading garbage).  But without keeping track of it,", "        researchers may not even know.", "", "    Bandpassing and degrees of freedom:", "", "        Bandpassing between 0.01 and 0.1 means, from just the lowpass side,", "        throwing away frequencies above 0.1.  So the higher the frequency of", "        collected data (i.e. the smaller the TR), the higher the fraction of", "        DoF will be thrown away.", "", "        For example, if TR = 2s, then the Nyquist frequency (the highest", "        frequency detectable in the data) is 1/(2*2) = 0.25 Hz.  That is to", "        say, one could only detect something going up and down at a cycle rate", "        of once every 4 seconds (twice the TR).", "", "        So for TR = 2s, approximately 40% of the DoF are kept (0.1/0.25) and", "        60% are lost (frequencies from 0.1 to 0.25) due to bandpassing.", "", "        To generalize, Nyquist = 1/(2*TR), so the fraction of DoF kept is", "", "            fraction kept = 0.1/Nyquist = 0.1/(1/(2*TR)) = 0.1*2*TR = 0.2*TR", "", "        For example,", "", "            at TR = 2 s,   0.4  of DoF are kept (60% are lost)", "            at TR = 1 s,   0.2  of DoF are kept (80% are lost)", "            at TR = 0.5 s, 0.1  of DoF are kept (90% are lost)", "            at TR = 0.1 s, 0.02 of DoF are kept (98% are lost)", "", "        Consider also:", "", "            Shirer WR, Jiang H, Price CM, Ng B, Greicius MD", "            Optimization of rs-fMRI pre-processing for enhanced signal-noise", "                separation, test-retest reliability, and group discrimination", "            Neuroimage. 2015 Aug 15;117:67-79.", "", "            Gohel SR, Biswal BB", "            Functional integration between brain regions at rest occurs in", "                multiple-frequency bands", "            Brain connectivity. 2015 Feb 1;5(1):23-34.", "", "            Caballero-Gaudes C, Reynolds RC", "            Methods for cleaning the BOLD fMRI signal", "            Neuroimage. 2017 Jul 1;154:128-49", "", "    Application of bandpassing in afni_proc.py:", "", "        In afni_proc.py, this is all done in a single regression model (removal", "        of noise and baseline signals, bandpassing and censoring).  If some", "        subject were to lose too many TRs due to censoring, this step would", "        fail, as it should.", "", "        There is an additional option of using simulated motion time series", "        in the regression model, which should be more effective than higher", "        order motion parameters, say.  This is done via @simulate_motion.", "", "    There are 3 main steps (generate ricor regs, pre-process, group analysis):", "", "        step 0: If physio recordings were made, generate slice-based regressors", "                using RetroTS.py.  Such regressors can be used by afni_proc.py", "                via the 'ricor' processing block.", "", "                RetroTS.m is Ziad Saad's MATLAB routine to convert the 2 time", "                series into 13 slice-based regressors.  RetroTS.m requires the", "                signal processing toolkit for MATLAB.", "", "                RetroTS.py is a conversion of RetroTS.m to python by J Zosky,", "                which depends on scipy.  See \"RetroTS.py -help\" for details.", "", "        step 1: analyze with afni_proc.py", "", "                Consider these afni_proc.py -help examples:", "                   5b.  case of ricor and no bandpassing", "                   5c.  ricor and bandpassing and full registration", "                   9.   no ricor, but with bandpassing", "                   9b.  with WMeLocal (local white-matter, eroded) - ANATICOR", "                   10.  also with tissue-based regressors", "                   10b. apply bandpassing via 3dRSFC", "                   soon: extra motion regs via motion simulated time series", "                         (either locally or not)", "                   11.  censor, despike, non-linear registration,", "                        no bandpassing, fast ANATICOR regression,", "                        FreeSurfer masks for ventricle/WM regression", "                      * see \"FREESURFER NOTE\" for more details", "", "            processing blocks:", "", "                despike (shrink large spikes in time series)", "                ricor   (if applicable, remove the RetroTS regressors)", "                tshift  (correct for slice timing)", "                align   (figure out alignment between anat and EPI)", "                tlrc    (figure out alignment between anat and template)", "                volreg  (align anat and EPI together, and to standard template)", "                blur    (apply desired FWHM blur to EPI data)", "                scale   (optional, e.g. before seed averaging)", "                regress (polort, motion, mot deriv, bandpass, censor)", "                        (depending on chosen options)", "                        soon: ANATICOR/WMeLocal", "                              extra motion regressors (via motion simulation)", "", "                ==> \"result\" is errts dataset, \"cleaned\" of known noise sources", "", "        step 2: correlation analysis, hopefully with 3dGroupInCorr", "", "            The inputs to this stage are the single subject errts datasets.", "", "            Ignoring 3dGroupInCorr, the basic steps in a correlation analysis", "            (and corresponding programs) are as follows.  This may be helpful", "            for understanding the process, even when using 3dGroupInCorr.", "", "                a. choose a seed voxel (or many) and maybe a seed radius", "", "                for each subject:", "", "                   b. compute time series from seed", "                      (3dmaskave or 3dROIstats)", "                   c. generate correlation map from seed TS", "                      (3dTcorr1D (or 3dDeconvolve or 3dfim+))", "                   d. normalize R->\"Z-score\" via Fisher's z-transform", "                      (3dcalc -expr atanh)", "", "                e. perform group test, maybe with covariates", "                   (3dttest++: 1-sample, 2-sample or paired)", "", "            To play around with a single subject via InstaCorr:", "", "                a. start afni (maybe show images of both anat and EPI)", "                b. start InstaCorr plugin from menu at top right of afni's", "                   Define Overlay panel", "                c. Setup Icorr:", "                    c1. choose errts dataset", "                       (no Start,End; no Blur (already done in pre-processing))", "                    c2. Automask -> No; choose mask dataset: full_mask", "                    c3. turn off Bandpassing (already done, if desired)", "                d. in image window, show correlations", "                    d1. go to seed location, right-click, InstaCorr Set", "                    OR", "                    d1. hold ctrl-shift, hold left mouse button, drag", "                e. have endless fun", "", "            To use 3dGroupInCorr:", "", "                a. run 3dSetupGroupIncorr with mask, labels, subject datasets", "                   (run once per group of subjects), e.g.", "", "                        3dSetupGroupInCorr                \\", "                            -labels subj.ID.list.txt      \\", "                            -prefix sic.GROUP             \\", "                            -mask EPI_mask+tlrc           \\", "                            errts_subj1+tlrc              \\", "                            errts_subj2+tlrc              \\", "                            errts_subj3+tlrc              \\", "                                ...                       \\", "                            errts_subjN+tlrc", "", "                    ==> sic.GROUP.grpincorr.niml (and .grpincorr.data)", "", "                b. run 3dGroupInCorr on 1 or 2 sic.GROUP datasets, e.g.", "", "                   Here are steps for running 3dGroupInCorr via the afni GUI.", "                   To deal with computers that have multiple users, consider", "                   specifying some NIML port block that others are not using.", "                   Here we use port 2 (-npb 2), just to choose one.", "", "                   b1. start afni:", "", "                        afni -niml -npb 2", "", "                   b2. start 3dGroupInCorr", "", "                        3dGroupInCorr -npb 2                    \\", "                            -setA sic.horses.grpincorr.niml     \\", "                            -setB sic.moths.grpincorr.niml      \\", "                            -labelA horses -labelB moths        \\", "                            -covaries my.covariates.txt         \\", "                            -center SAME -donocov -seedrad 5", "", "                   b3. play with right-click -> InstaCorr Set or", "                      hold ctrl-shift/hold left mouse and drag slowly", "", "                   b4. maybe save any useful dataset via", "                      Define Datamode -> SaveAs OLay (and give a useful name)", "", "                b'. alternative, generate result dataset in batch mode, by", "                    adding -batch and some parameters to the 3dGIC command", "", "                    e.g.  -batch XYZAVE GIC.HvsM.PFC 4 55 26", "", "                    In such a case, afni is not needed at all.  The resulting", "                    GIC.HvsM.PFC+tlrc dataset would be written out without any", "                    need to start the afni GUI.  This works well since seed", "                    coordinates for group tests are generally known in advance.", "", "                    See the -batch option under \"3dGroupInCorr -help\" for many", "                    details and options.", "", "                c. threshold/clusterize resulting datasets, just as with a", "                   task analysis", "", "                   (afni GUI, 3dclust, or 3dmerge)", "", "    --------------------------------------------------", "    FREESURFER NOTE: ~2~", "", "    FreeSurfer output can be used for a few things in afni_proc.py:", "", "        - simple skull stripping (i.e. instead of 3dSkullStrip)", "        - running a surface-based analysis", "        - using parcellation datasets for:", "           - tissue-based regression", "           - creating group probability maps", "           - creating group atlases (e.g. maximum probability maps)", "", "    This NOTE mainly refers to using FreeSurfer parcellations for tissue-based", "    regression, as is done in Example 11.", "", "", "    First run FreeSurfer, then import to AFNI using @SUMA_Make_Spec_FS, then", "    make ventricle and white matter masks from the Desikan-Killiany atlas based", "    parcellation dataset, aparc+aseg.nii.", "", "    Note that the aparc.a2009s segmentations are based on the Destrieux atlas,", "    which might be nicer for probability maps, though the Desikan-Killiany", "    aparc+aseg segmentation is currently used for segmenting white matter and", "    ventricles.  I have not studied the differences.", "", "", "    Example 11 brings the aparc.a2009s+aseg segmentation along (for viewing or", "    atlas purposes, aligned with the result), though the white matter and", "    ventricle masks are based instead on aparc+aseg.nii.", "", "        # run (complete) FreeSurfer on FT.nii", "        recon-all -all -subject FT -i FT.nii", "", "        # import to AFNI, in NIFTI format", "        @SUMA_Make_Spec_FS -sid FT -NIFTI", "", "        # create ventricle and white matter masks", "        #", "        # ** warning: it would be good to convert these indices to labels", "        #             in case the output from FreeSurfer is changed", "", "        3dcalc -a aparc+aseg.nii -datum byte -prefix FT_vent.nii \\", "               -expr 'amongst(a,4,43)'", "        3dcalc -a aparc+aseg.nii -datum byte -prefix FT_WM.nii \\", "               -expr 'amongst(a,2,7,41,46,251,252,253,254,255)'", "", "        # note: 16 (brainstem) was incorrectly included from @ANATICOR", "        #       and then in this help through 2016", "", "    After this, FT_SurfVol.nii, FT_vent.nii and FT_WM.nii (along with the", "    basically unused aparc.a2009s+aseg.nii) are passed to afni_proc.py.", "", "", "  * Be aware that the output from FreeSurfer (e.g. FT_SurfVol.nii) will", "    usually not quite align with the input (e.g. FT.nii).  So parcellation", "    datasets will also not quite align with the input (FT.nii).  Therefore,", "    when passing parcellation volumes to afni_proc.py for tissue-based", "    regression, it is important to use the anatomy output from FreeSurfer", "    as the subject anatomy (input to afni_proc.py).  That way, the anatomy", "    and parcellation datasets will be in register, and therefore the EPI", "    will eventually align with the parcellation datasets.", "", "    If it is important to have the FreeSurfer output align with the input,", "    it might help to pass a m"], "params": [{"param_range": [1000, 1002], "help_range": [986, 22544]}, {"param_range": [22560, 22562], "help_range": [22545, 22648]}], "previous": "afni_proc.py_part11.json", "next": "afni_proc.py_part13.json"}